<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BeetlSQL SQL æŒ–ç©ºå¡«å……å·¥å…·</title>
  <!-- å¼•å…¥ Arco Design Vue -->
  <link rel="stylesheet" href="https://unpkg.com/@arco-design/web-vue/dist/arco.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/@arco-design/web-vue/dist/arco-vue.min.js"></script>
  <!-- å¼•å…¥ Monaco Editor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
  <!-- SQL è¯­æ³•é«˜äº®åº“ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: "Microsoft Yahei", "PingFang SC", "Segoe UI", sans-serif;
      background-color: #f5f6f7;
      padding: 12px;
      height: 100vh;
      overflow: hidden;
    }
    
    #app {
      height: calc(100vh - 24px);
      display: flex;
      flex-direction: column;
    }
    
    .page-title {
      text-align: center;
      color: #1f2937;
      margin-bottom: 12px;
      font-weight: 600;
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .main-content {
      flex: 1;
      display: flex;
      gap: 16px;
    }
    
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.06);
      padding: 12px;
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .card-header {
      color: #303133;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e8e9eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }
    
    /* Monaco ç¼–è¾‘å™¨å®¹å™¨ */
    #editor-container {
      flex: 1;
      border: 1px solid #e8e9eb;
      border-radius: 6px;
      overflow: hidden;
    }
    
    #monaco-editor {
      width: 100%;
      height: 100%;
    }
    
    .sql-box {
      background: #1a1b26;
      padding: 10px;
      border-radius: 6px;
      white-space: pre-wrap;
      font-family: "Consolas", "Monaco", monospace;
      font-size: 12px;
      line-height: 1.4;
      flex: 1;
      min-height: 0;
      overflow-x: auto;
      overflow-y: auto;
      color: #a9b1d6;
      margin-top: 4px;
    }
    
    .input-area {
      background: #1a1b26;
      padding: 10px;
      border-radius: 6px;
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      font-family: "Consolas", "Monaco", monospace;
      font-size: 12px;
      line-height: 1.4;
      color: #a9b1d6;
      white-space: pre-wrap;
      overflow-wrap: break-word;
      margin-top: 4px;
    }
    
    /* æ ¸å¿ƒä¿®å¤ï¼šå‚æ•°è¾“å…¥æ¡†å®¹å™¨æ ·å¼ */
    .param-wrapper {
      display: inline-block;
      vertical-align: middle;
      margin: 0 1px;
      position: relative;
      height: 22px;
      line-height: 22px;
    }
    
    /* è¾“å…¥æ¡†åŸºç¡€æ ·å¼ - å…³é”®ä¿®å¤ */
    .sql-input, .sql-number-input, .sql-date-input {
      width: 120px !important;
      display: inline-block !important;
      margin: 0 !important;
      background: #282a36 !important;
      border-color: #44475a !important;
      color: #f8f8f2 !important;
      font-size: 12px !important;
      height: 22px !important;
      line-height: 22px !important;
      vertical-align: baseline !important;
      position: relative !important;
    }
    
    .sql-number-input {
      width: 100px !important;
    }
    
    .sql-date-input {
      width: 160px !important;
    }
    
    /* æ·±åº¦é€‰æ‹©å™¨è¦†ç›– Arco ç»„ä»¶æ ·å¼ - æ ¸å¿ƒä¿®å¤ */
    .input-area :deep(.arco-input),
    .input-area :deep(.arco-input-inner),
    .input-area :deep(.arco-input-tag) {
      background: #282a36 !important;
      border-color: #44475a !important;
      color: #f8f8f2 !important;
      height: 22px !important;
      line-height: 22px !important;
      font-size: 12px !important;
      padding: 0 24px 0 8px !important; /* å³ä¾§ç•™å‡ºæ¸…é™¤æŒ‰é’®ç©ºé—´ */
      border-radius: 4px !important;
      width: 100% !important;
    }
    
    .input-area :deep(.arco-input-inner::placeholder) {
      color: #6272a4 !important;
    }
    
    .input-area :deep(.arco-input:hover),
    .input-area :deep(.arco-input:focus) {
      border-color: #61afef !important;
      box-shadow: 0 0 0 2px rgba(97, 175, 239, 0.2) !important;
    }
    
    /* æ¸…é™¤æŒ‰é’®æ ·å¼ - æ ¸å¿ƒä¿®å¤ */
    .input-area :deep(.arco-input-suffix) {
      position: absolute !important;
      right: 6px !important;
      top: 50% !important;
      transform: translateY(-50%) !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      width: 16px !important;
      height: 16px !important;
      z-index: 10 !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    
    .input-area :deep(.arco-input-clear-icon) {
      color: #f8f8f2 !important;
      cursor: pointer !important;
      font-size: 14px !important;
      width: 16px !important;
      height: 16px !important;
      line-height: 1 !important;
    }
    
    .input-area :deep(.arco-input-clear-icon:hover) {
      color: #ff5555 !important;
    }
    
    /* æ•°å­—è¾“å…¥æ¡†æ ·å¼ä¿®å¤ */
    .input-area :deep(.arco-input-number) {
      background: #282a36 !important;
      border-color: #44475a !important;
      color: #f8f8f2 !important;
      height: 22px !important;
      width: 100% !important;
    }
    
    .input-area :deep(.arco-input-number-input) {
      background: #282a36 !important;
      border-color: #44475a !important;
      color: #f8f8f2 !important;
      height: 22px !important;
      line-height: 22px !important;
      text-align: left !important;
      padding: 0 24px 0 8px !important;
      font-size: 12px !important;
    }
    
    .input-area :deep(.arco-input-number-handler-wrap) {
      display: none !important; /* éšè—æ•°å­—å¢å‡æŒ‰é’®ï¼Œé¿å…å¸ƒå±€é—®é¢˜ */
    }
    
    /* æ—¥æœŸé€‰æ‹©å™¨æ ·å¼ä¿®å¤ */
    .input-area :deep(.arco-picker) {
      display: inline-block !important;
      vertical-align: middle !important;
      height: 22px !important;
      line-height: 22px !important;
      width: 100% !important;
      position: relative !important;
    }
    
    .input-area :deep(.arco-picker-trigger) {
      height: 22px !important;
      line-height: 22px !important;
      width: 100% !important;
    }
    
    .input-area :deep(.arco-picker-input) {
      height: 22px !important;
      line-height: 22px !important;
      width: 100% !important;
    }
    
    .input-area :deep(.arco-picker-input-input) {
      background: #282a36 !important;
      border-color: #44475a !important;
      color: #f8f8f2 !important;
      height: 22px !important;
      line-height: 22px !important;
      font-size: 12px !important;
      padding: 0 36px 0 8px !important; /* ä¸ºæ¸…é™¤æŒ‰é’®å’Œæ—¥å†å›¾æ ‡ç•™ç©ºé—´ */
      width: 100% !important;
    }
    
    .input-area :deep(.arco-picker-icon) {
      color: #8be9fd !important;
      position: absolute !important;
      right: 8px !important;
      top: 50% !important;
      transform: translateY(-50%) !important;
      z-index: 10 !important;
    }
    
    .input-area :deep(.arco-picker-clear-icon) {
      position: absolute !important;
      right: 28px !important; /* åœ¨æ—¥å†å›¾æ ‡å·¦ä¾§ */
      top: 50% !important;
      transform: translateY(-50%) !important;
      color: #f8f8f2 !important;
      z-index: 10 !important;
    }
    
    /* æ—¥æœŸé¢æ¿æ ·å¼ */
    :deep(.arco-picker-panel) {
      background: #1a1b26 !important;
    }
    
    :deep(.arco-picker-panel-header) {
      background: #282a36 !important;
    }
    
    :deep(.arco-picker-panel-header-icon) {
      color: #f8f8f2 !important;
    }
    
    :deep(.arco-picker-panel-header-icon:hover) {
      color: #61afef !important;
    }
    
    :deep(.arco-picker-cell) {
      color: #a9b1d6 !important;
    }
    
    :deep(.arco-picker-cell:hover) {
      background: #282a36 !important;
    }
    
    :deep(.arco-picker-cell-selected) {
      background: #61afef !important;
      color: #1a1b26 !important;
    }
    
    :deep(.arco-picker-cell-today) {
      color: #50fa7b !important;
    }
    
    :deep(.arco-picker-footer) {
      background: #282a36 !important;
      border-top-color: #44475a !important;
    }
    
    :deep(.arco-picker-footer-btn) {
      color: #f8f8f2 !important;
    }
    
    :deep(.arco-picker-footer-btn:hover) {
      background: #44475a !important;
    }
    
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    
    .copy-btn, .setting-btn {
      padding: 3px 8px;
      font-size: 12px;
    }

    .type-set-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .type-set-label {
      width: 90px;
      flex-shrink: 0;
      font-size: 13px;
      font-weight: 500;
    }
    .type-set-select {
      width: 140px;
    }
    
    /* é«˜äº®æ ·å¼ */
    .hljs-keyword {
      color: #ff79c6 !important;
    }
    
    .hljs-built_in {
      color: #8be9fd !important;
    }
    
    .hljs-string {
      color: #f1fa8c !important;
    }
    
    .hljs-number {
      color: #bd93f9 !important;
    }
    
    .hljs-comment {
      color: #6272a4 !important;
    }
    
    .hljs-literal {
      color: #bd93f9 !important;
    }
    
    .hljs-operator {
      color: #ff79c6 !important;
    }
    
    .hljs-punctuation {
      color: #f8f8f2 !important;
    }
    
    .warning-tip {
      color: #e6a23c;
      font-size: 12px;
      margin-top: 8px;
      padding: 6px 8px;
      background: #fff7e6;
      border-radius: 4px;
      border-left: 3px solid #e6a23c;
    }
    
    .footer-tip {
      margin-top: 8px;
      font-size: 11px;
      color: #999;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1 class="page-title">BeetlSQL SQL æŒ–ç©ºå¡«å……å·¥å…·</h1>
    
    <div class="main-content">
      <!-- å·¦ä¾§ï¼šMonaco Editor -->
      <div style="flex: 1; min-width: 0;">
        <div class="card">
          <div class="card-header">
            <span>ğŸ“ åŸå§‹ BeetlSQL</span>
            <a-button type="text" size="mini" class="copy-btn" @click="copyOriginalSql">
              <template #icon><icon-copy /></template>
              å¤åˆ¶
            </a-button>
          </div>
          <div id="editor-container">
            <div id="monaco-editor"></div>
          </div>
        </div>
      </div>

      <!-- å³ä¾§ï¼šæŒ–ç©ºç•Œé¢ + å¡«å……åSQL -->
      <div style="flex: 1.4; min-width: 0; display: flex; flex-direction: column; gap: 16px;">
        <!-- æŒ–ç©ºç•Œé¢ -->
        <div class="card" style="flex: 0.7;">
          <div class="card-header">
            <span>ğŸ” æŒ–ç©ºç•Œé¢ï¼ˆå¯è¾“å…¥å‚æ•°ï¼‰</span>
            <a-button 
              type="text" 
              size="mini"
              class="setting-btn" 
              @click="openTypeSetting"
            >
              <template #icon><icon-settings /></template>
              ç±»å‹è®¾ç½®
            </a-button>
          </div>
          <div class="input-area" ref="inputAreaRef" v-if="showInputArea">
            <template v-for="(item, index) in sqlParts" :key="`part-${index}-${paramTypeMap[item.param] || 'default'}`">
              <span 
                class="sql-text-fragment" 
                :key="`text-${index}`"
                v-html="highlightText(item.text)"
              ></span>
              <template v-if="item.param">
                <span class="param-wrapper" :key="`wrap-${item.param}`">
                  <component 
                    :is="getInputComponent(paramTypeMap[item.param])" 
                    :model-value="params[item.param]" 
                    @update:model-value="updateParam(item.param, $event)" 
                    :class="getInputClass(paramTypeMap[item.param])"
                    size="mini"
                    :placeholder="item.param"
                    :precision="getNumberPrecision(item.param)"
                    :min="-Infinity"
                    :max="Infinity"
                    :show-time="paramTypeMap[item.param] === 'datetime'"
                    format="YYYY-MM-DD"
                    value-format="YYYY-MM-DD"
                    allow-clear
                    :key="`comp-${item.param}-${paramTypeMap[item.param]}-${refreshKey}`"
                  />
                </span>
              </template>
            </template>
          </div>
        </div>

        <!-- å¡«å……åçš„SQL -->
        <div class="card" style="flex: 0.3;">
          <div class="card-header">
            <span>âœ… å¯æ‰§è¡ŒSQL</span>
            <a-button type="text" size="mini" class="copy-btn" @click="copyFilledSql">
              <template #icon><icon-copy /></template>
              å¤åˆ¶
            </a-button>
          </div>
          <div class="sql-box" ref="filledSqlRef" v-html="highlightText(executableSql)"></div>
          <div class="warning-tip">
            âš ï¸ æœ¬å·¥å…·ä»…å¤„ç†å‚æ•°æ›¿æ¢ï¼Œå¤æ‚BeetlSQLé€»è¾‘ï¼ˆå¾ªç¯/æ¡ä»¶ï¼‰éœ€æ‰‹åŠ¨è°ƒæ•´ç”Ÿæˆçš„SQL
          </div>
          <div class="footer-tip">
            å¤šä¸ªSQLè¯­å¥ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš” Â· ç”ŸæˆSQLå·²ä¼˜åŒ–æ ¼å¼
          </div>
        </div>
      </div>
    </div>

    <!-- å‚æ•°ç±»å‹è®¾ç½®å¼¹çª— -->
    <a-modal
      title="å‚æ•°ç±»å‹è®¾ç½®"
      v-model:visible="typeSettingVisible"
      width="380px"
      :footer="false"
    >
      <div v-for="param in paramList" :key="`set-${param}`" class="type-set-item">
        <span class="type-set-label">{{ param }}ï¼š</span>
        <a-select
          v-model="paramTypeMap[param]"
          class="type-set-select"
          size="small"
          @change="handleParamTypeChange(param)"
        >
          <a-option label="æ–‡æœ¬æ¡†" value="text"></a-option>
          <a-option label="æ•°å­—æ¡†" value="number"></a-option>
          <a-option label="æ—¥æœŸé€‰æ‹©å™¨" value="date"></a-option>
          <a-option label="æ—¶é—´é€‰æ‹©å™¨" value="datetime"></a-option>
        </a-select>
      </div>
    </a-modal>
  </div>

  <script>
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
    
    const { createApp, ref, reactive, computed, watch, nextTick, onMounted } = Vue;
    const { Message } = ArcoVue;
    const { IconCopy, IconSettings } = ArcoVue.Icon;
    
    let editor;
    
    const app = createApp({
      components: {
        IconCopy,
        IconSettings
      },
      setup() {
        const originalSql = ref(`select *
from sys_user u
where 1=1
-- @ if(!isBlank(userName)){
    and user_name = #{userName}
-- @ }
-- @ if(!isBlank(deptId)){
    and dept_id = #{deptId}
-- @ }
order by u.dept_id desc;

-- æ‰¹é‡æ’å…¥ç¤ºä¾‹
insert into demo_dept(name, date_create) 
values
-- @trim(){for(item in list) {
    (#{item.name}, #{item.dateCreate}),
-- @}}`);

        const params = reactive({});
        const paramTypeMap = reactive({});
        const paramList = ref([]);
        const typeSettingVisible = ref(false);
        const showInputArea = ref(true);
        const refreshKey = ref(Date.now());
        const paramNameMap = reactive({});
        const hljs = window.hljs;
        
        const sqlParts = computed(() => {
          const regex = /#\{([\w.]+)\}/g;
          const parts = [];
          let lastIndex = 0;
          let match;
          const newParamList = [];
          const newParamNameMap = {};
          
          while ((match = regex.exec(originalSql.value)) !== null) {
            const text = originalSql.value.slice(lastIndex, match.index);
            const originalParam = match[1];
            let paramKey = originalParam.replace(/\./g, '_');
            
            parts.push({ text, param: paramKey });
            
            newParamNameMap[paramKey] = originalParam;
            
            if (!newParamList.includes(paramKey)) {
              newParamList.push(paramKey);
              
              if (!paramTypeMap[paramKey]) {
                initParamType(paramKey);
              }
              
              if (!(paramKey in params)) {
                params[paramKey] = getInitValue(paramKey);
              }
            }
            
            lastIndex = match.index + match[0].length;
          }
          
          parts.push({ text: originalSql.value.slice(lastIndex) });
          paramList.value = newParamList;
          Object.assign(paramNameMap, newParamNameMap);
          return parts;
        });

        const executableSql = computed(() => {
          let sql = originalSql.value;
          
          // 1. å…ˆæ›¿æ¢æ‰€æœ‰å‚æ•°ï¼ˆåœ¨ç§»é™¤æ³¨é‡Šå‰ï¼ï¼‰
          for (const [paramKey, originalParam] of Object.entries(paramNameMap)) {
            const val = params[paramKey] ?? '';
            
            let strVal;
            if (paramTypeMap[paramKey] === 'number') {
              const num = Number(val);
              strVal = isNaN(num) ? '0' : String(num);
            } else if (val === '' || val === null || val === undefined) {
              strVal = "''";
            } else {
              strVal = `'${String(val).replace(/'/g, "''")}'`;
            }
            
            const escapedParam = originalParam.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const pattern = new RegExp(`#\\{${escapedParam}\\}`, 'g');
            sql = sql.replace(pattern, strVal);
          }
          
          // 2. ç§»é™¤å¤šè¡Œæ³¨é‡Š
          sql = sql.replace(/\/\*[\s\S]*?\*\//g, '');
          
          // 3. æ™ºèƒ½å¤„ç†å•è¡Œæ³¨é‡Šå’ŒBeetlSQLæŒ‡ä»¤
          const lines = sql.split('\n');
          const processedLines = [];
          
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            
            // è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Šè¡Œ
            if (line === '' || line.startsWith('--')) {
              continue;
            }
            
            processedLines.push(line);
          }
          
          sql = processedLines.join('\n');
          
          // 4. ä¼˜åŒ–SQLæ ¼å¼ï¼šç´§å‡‘åŒ–ï¼Œå¤šè¯­å¥é—´ç”¨ç©ºè¡Œåˆ†éš”
          return sql
            .replace(/,\s*$/gm, '') // ç§»é™¤è¡Œå°¾é€—å·
            .replace(/\b(AND|OR)\s+(AND|OR)\b/gi, '$1') // æ¸…ç†é‡å¤çš„AND/OR
            .replace(/WHERE\s+(AND|OR)\b/gi, 'WHERE') // æ¸…ç†WHEREåçš„AND/OR
            .replace(/\s+(AND|OR)\s*$/gim, '') // æ¸…ç†è¡Œå°¾çš„AND/OR
            .replace(/\s+/g, ' ') // å¤šä¸ªç©ºæ ¼åˆå¹¶ä¸ºä¸€ä¸ª
            .replace(/;\s*/g, ';\n\n') // è¯­å¥é—´ç”¨ç©ºè¡Œåˆ†éš”
            .replace(/\n{3,}/g, '\n\n') // æœ€å¤šä¸¤ä¸ªè¿ç»­ç©ºè¡Œ
            .trim()
            .replace(/;$/, ''); // ç§»é™¤æœ«å°¾åˆ†å·
        });

        watch(originalSql, (val) => {
          if (editor && editor.getValue() !== val) {
            editor.setValue(val);
          }
        });

        const initParamType = (param) => {
          if (/date|time/i.test(param)) {
            paramTypeMap[param] = 'datetime';
          } else if (/price|num|size|amount|id|dept/i.test(param)) {
            paramTypeMap[param] = 'number';
          } else {
            paramTypeMap[param] = 'text';
          }
        };
        
        const getInitValue = (param) => {
          const type = paramTypeMap[param];
          switch (type) {
            case 'number': return 0;
            case 'date':
            case 'datetime': return formatDate(new Date());
            default: return '';
          }
        };
        
        const formatDate = (date) => {
          const d = new Date(date);
          const year = d.getFullYear();
          const month = String(d.getMonth() + 1).padStart(2, '0');
          const day = String(d.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        };
        
        const getNumberPrecision = (param) => {
          return /price|money|amount/.test(param) ? 2 : 0;
        };
        
        const getInputComponent = (type) => {
          const map = {
            number: 'a-input-number',
            date: 'a-date-picker',
            datetime: 'a-date-picker',
            text: 'a-input'
          };
          return map[type] || 'a-input';
        };
        
        const getInputClass = (type) => {
          const map = {
            number: 'sql-number-input',
            date: 'sql-date-input',
            datetime: 'sql-date-input',
            text: 'sql-input'
          };
          return map[type] || 'sql-input';
        };
        
        const updateParam = (param, value) => {
          // å¤„ç†æ—¥æœŸç»„ä»¶è¿”å›çš„å€¼
          if (paramTypeMap[param] === 'date' || paramTypeMap[param] === 'datetime') {
            if (value && typeof value === 'string') {
              params[param] = value;
            } else if (value instanceof Date) {
              params[param] = formatDate(value);
            } else {
              params[param] = formatDate(new Date());
            }
          } else if (value === null || value === undefined || value === '') {
            params[param] = '';
          } else {
            params[param] = value;
          }
        };
        
        const highlightText = (text) => {
          if (!text) return '';
          try {
            return hljs.highlight(text, { language: 'sql' }).value;
          } catch (e) {
            return text;
          }
        };
        
        const openTypeSetting = () => {
          typeSettingVisible.value = true;
        };
        
        const handleParamTypeChange = (param) => {
          const oldVal = params[param];
          const newType = paramTypeMap[param];
          
          let newVal = oldVal;
          switch (newType) {
            case 'number':
              newVal = isNaN(Number(oldVal)) ? 0 : Number(oldVal);
              break;
            case 'date':
            case 'datetime':
              // ç¡®ä¿è¿”å›æ ‡å‡†æ—¥æœŸæ ¼å¼
              if (oldVal && typeof oldVal === 'string') {
                newVal = oldVal;
              } else {
                newVal = formatDate(new Date());
              }
              break;
            default:
              newVal = String(oldVal ?? '');
          }
          
          params[param] = newVal;
          
          // å¼ºåˆ¶é‡æ¸²æŸ“
          showInputArea.value = false;
          nextTick(() => {
            refreshKey.value = Date.now();
            showInputArea.value = true;
          });
        };
        
        const copyToClipboard = async (text) => {
          try {
            await navigator.clipboard.writeText(text);
            Message.success('å¤åˆ¶æˆåŠŸï¼');
          } catch (e) {
            const ta = document.createElement('textarea');
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            Message.success('å¤åˆ¶æˆåŠŸï¼');
          }
        };
        
        const copyOriginalSql = () => {
          copyToClipboard(editor?.getValue() || originalSql.value);
        };
        
        const copyFilledSql = () => {
          copyToClipboard(executableSql.value);
        };

        onMounted(() => {
          nextTick(() => {
            require(['vs/editor/editor.main'], () => {
              editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                value: originalSql.value,
                language: 'sql',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: false },
                fontSize: 13,
                scrollbar: {
                  vertical: 'auto',
                  horizontal: 'auto'
                },
                wordWrap: 'on',
                lineNumbers: 'on',
                renderWhitespace: 'none'
              });
              
              editor.onDidChangeModelContent(() => {
                originalSql.value = editor.getValue();
              });
            });
          });
        });

        return {
          originalSql,
          params,
          paramTypeMap,
          paramList,
          typeSettingVisible,
          showInputArea,
          refreshKey,
          hljs,
          paramNameMap,
          sqlParts,
          executableSql,
          initParamType,
          getInitValue,
          formatDate,
          getNumberPrecision,
          getInputComponent,
          getInputClass,
          updateParam,
          highlightText,
          openTypeSetting,
          handleParamTypeChange,
          copyOriginalSql,
          copyFilledSql
        };
      }
    });

    app.use(ArcoVue);
    app.mount('#app');
  </script>
</body>
</html>